<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width; initial-scale=1">
		<title>Index</title>
		<link rel="stylesheet" href="/style.css">
	</head>
	<body>
		<h1>Checkout</h1>
		<ul>
			<%
				let total = 0;
				if (locals.products) {
					for (const product of products) {
						total += product.quantity * product.price * 0.01;
						let price = Math.min(product.salePrice || product.price, product.price);
			%>
			<li>
				<p><%= product.title %></p>
				<p><img src="<%= product.image || "http://placekitten.com/200/200" %>"></p>
				<% 	if (product.salePrice && product.salePrice < product.price) { %>
				<p><del>$<%= (product.price * 0.01).toFixed(2) %></del> $<%= (product.salePrice * 0.01).toFixed(2) %> x <%= product.quantity %> = $<%= (product.quantity * price * 0.01).toFixed(2) %></p>
				<% 	} else { %>
				<p>$<%= (price * 0.01).toFixed(2) %> x <%= product.quantity %> = $<%= (product.quantity * price * 0.01).toFixed(2) %></p>
				<% 	} %>
			</li>
			<%
					}
				}
			%>
		</ul>
		<p>Total: $<%= total.toFixed(2) %></p>
		<script>
			{
				const addButtons = document.querySelectorAll(".add-button");
				addButtons.forEach(button => {
					button.addEventListener("click", event => {
						fetch("/cart-add", {
							headers: {
								"Content-Type": "application/json",
							},
							method: "POST",
							body: JSON.stringify({
								id: event.currentTarget.dataset.productId,
								quantity: 1,
							}),
						}).then(response => {
							if (response.status === 200) alert("Added to cart.");
						});
					});
				});
			}
		</script>
	</body>
</html>