<%- include("../parts/header") %>
		<% if (locals.product) { %>
		<p id="message" style="display: none;">Added to cart</p>
		<h1><%= product.title %></h1>
		<p><img src="<%= product.image || "http://placekitten.com/200/200" %>"></p>
		<% 	if (product.salePrice && product.salePrice < product.price) { %>
		<p><del>$<%= (product.price * 0.01).toFixed(2) %></del> $<%= (product.salePrice * 0.01).toFixed(2) %></p>
		<% 	} else { %>
		<p>$<%= (product.price * 0.01).toFixed(2) %></p>
		<% 	} %>
		<p>
			<input id="quantity" type="number" min="0" value="1">
			<button id="add" data-product-id="<%= product.id %>">Add to Cart</button>
		</p>
		<p><%= product.description %></p>
		<script>
			{
				let adding = false;
				const message = document.querySelector("#message");
				message.addEventListener("click", event => message.style.display = "none");
				const quantity = document.querySelector("#quantity");
				const add = document.querySelector("#add");
				add.addEventListener("click", event => {
					if (adding) return;
					adding = true;
					fetch("/cart-add/", {
						headers: {
							"Content-Type": "application/json",
						},
						method: "POST",
						body: JSON.stringify({
							id: event.currentTarget.dataset.productId,
							quantity: quantity.value,
						}),
					}).then(response => {
						if (response.status === 200) message.style.display = null;
						adding = false;
					});
				});
			}
		</script>
		<% } else { %>
		<h1>Error!</h1>
		<p>We can't find the product you are looking for.</p>
		<% } %>
<%- include("../parts/footer") %>